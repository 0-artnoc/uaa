buildscript {
  repositories {
    mavenCentral()
  }
  
  dependencies {
    classpath "net.saliman:gradle-cobertura-plugin:2.2.2"
  }
}

allprojects  {
  apply plugin: 'maven'
  group = 'org.cloudfoundry.identity'
  version = '1.7.3-SNAPSHOT'
  
  apply plugin: 'cobertura'
  
  repositories {
    mavenCentral()
  }
}

subprojects {
  apply plugin: 'java'
  sourceCompatibility = 1.7
  targetCompatibility = 1.7

  task packageSources(type: Jar) {
    classifier = 'sources'
    from sourceSets.main.allSource

  }
  artifacts.archives packageSources
  repositories {
    maven { url "http://maven.springframework.org/release" }
    maven { url "http://maven.springframework.org/milestone" }
    maven { url "http://maven.springframework.org/snapshot" }
    maven { url "http://objectstyle.org/maven2/" }
    maven { url "http://repo.springsource.org/ext-release-local" }
    maven { url "http://repo.maven.apache.org/maven2" }
  }

  configurations.all {
  }
}

cobertura {
  coverageFormats = ['xml', 'html']
  coverageMergeDatafiles = [
    new File("common/build/cobertura/cobertura.ser"),
    new File("scim/build/cobertura/cobertura.ser"),
    new File("uaa/build/cobertura/cobertura.ser"),
    new File(System.properties['java.io.tmpdir'] + 'cargo/conf/cobertura.ser')
  ]
  coverageExcludes = ['.*org.cloudfoundry.identity.uaa.coverage.CoverageController']
}

test.dependsOn([
  ":cloudfoundry-identity-common:test",
  ":cloudfoundry-identity-scim:test",
  ":cloudfoundry-identity-uaa:test"
])
