User->Client: GET /peek
participant AuthServer

activate User
activate Client

Client->Session: store request=/peek, foo=???
activate Session
Client->User: 302: location=auth/authorize?state=foo
deactivate User
deactivate Client

User->AuthServer: GET /authorize?state=foo
activate User
activate AuthServer
AuthServer->User: {messages: "Do you approve?"}
deactivate User
deactivate AuthServer

User->AuthServer: approve
activate User
activate AuthServer
AuthServer->User: 302: location=client/handle_code?code=dkshfjg&state=foo
deactivate User
deactivate AuthServer

User->Client: GET /handle_code?code=dkshfjg&state=foo
activate User
activate Client

Client->Session: get foo
Session->Client: ????
Client->Client: check state
Client->AuthServer: POST: /token?code=dkshfjg
activate AuthServer
AuthServer->Client: {access_token:sdhgf, state:foo} 
deactivate AuthServer

Client->Session: get request
Session->Client: /peek
Client->ResourceServer: request(access_token)
activate ResourceServer
ResourceServer->Client: response
deactivate ResourceServer

Client->User: result
deactivate Client
deactivate User
